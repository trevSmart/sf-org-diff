<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrgDiff - Comparador de Metadata Salesforce</title>
    <link rel="stylesheet" href="/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <!-- Import map for CodeMirror ESM modules -->
    <script type="importmap">
    {
        "imports": {
            "codemirror": "/node_modules/codemirror/dist/index.js",
            "@codemirror/merge": "/node_modules/@codemirror/merge/dist/index.js",
            "@codemirror/state": "/node_modules/@codemirror/state/dist/index.js",
            "@codemirror/view": "/node_modules/@codemirror/view/dist/index.js",
            "@codemirror/language": "/node_modules/@codemirror/language/dist/index.js",
            "@codemirror/commands": "/node_modules/@codemirror/commands/dist/index.js",
            "@codemirror/search": "/node_modules/@codemirror/search/dist/index.js",
            "@codemirror/autocomplete": "/node_modules/@codemirror/autocomplete/dist/index.js",
            "@codemirror/lint": "/node_modules/@codemirror/lint/dist/index.js",
            "@codemirror/lang-javascript": "/node_modules/@codemirror/lang-javascript/dist/index.js",
            "@codemirror/lang-xml": "/node_modules/@codemirror/lang-xml/dist/index.js",
            "@codemirror/lang-html": "/node_modules/@codemirror/lang-html/dist/index.js",
            "@codemirror/lang-css": "/node_modules/@codemirror/lang-css/dist/index.js",
            "@codemirror/lang-json": "/node_modules/@codemirror/lang-json/dist/index.js",
            "@lezer/common": "/node_modules/@lezer/common/dist/index.js",
            "@lezer/lr": "/node_modules/@lezer/lr/dist/index.js",
            "@lezer/highlight": "/node_modules/@lezer/highlight/dist/index.js",
            "@lezer/javascript": "/node_modules/@lezer/javascript/dist/index.js",
            "@lezer/xml": "/node_modules/@lezer/xml/dist/index.js",
            "@lezer/html": "/node_modules/@lezer/html/dist/index.js",
            "@lezer/css": "/node_modules/@lezer/css/dist/index.js",
            "@lezer/json": "/node_modules/@lezer/json/dist/index.js",
            "@marijn/find-cluster-break": "/node_modules/@marijn/find-cluster-break/src/index.js",
            "style-mod": "/node_modules/style-mod/src/style-mod.js",
            "w3c-keyname": "/node_modules/w3c-keyname/index.js",
            "crelt": "/node_modules/crelt/index.js"
        }
    }
    </script>
</head>
<body>
    <!-- Indicador de modo DEV -->
    <div id="devModeIndicator" class="dev-mode-indicator" style="display: none;">
        <i class="fas fa-code"></i>
        <span>DEV MODE</span>
    </div>
    <!-- Toggle global de tema clar/fosc -->
    <div class="global-theme-toggle">
        <label class="theme-toggle-switch" title="Alternar tema claro/oscuro">
            <input type="checkbox" id="themeToggleBtn">
            <span class="theme-toggle-slider"></span>
        </label>
    </div>
    <!-- Pantalla 1: Selección de Orgs -->
    <div id="screen1" class="screen">
        <div class="container">
            <h1><i class="fas fa-cubes"></i> OrgDiff - Comparador de Metadata Salesforce</h1>
            <div class="org-selection">
                <div class="org-selection-header">
                    <div id="loadingMessage" class="loading-message">Cargando orgs de Salesforce...</div>
                </div>
                <div class="org-selection-row">
                    <div class="org-selector">
                        <label for="orgA">
                            <span class="component-symbol symbol-org-a">A</span>
                            <span style="margin-left: 8px;">Org A:</span>
                        </label>
                        <select id="orgA" name="orgA" disabled>
                            <option value="">-- Cargando orgs... --</option>
                        </select>
                    </div>
                    <div class="org-info-separator">
                        <i class="fas fa-arrow-right-arrow-left separator-icon"></i>
                    </div>
                    <div class="org-selector">
                        <label for="orgB">
                            <span class="component-symbol symbol-org-b">B</span>
                            <span style="margin-left: 8px;">Org B:</span>
                        </label>
                        <select id="orgB" name="orgB" disabled>
                            <option value="">-- Cargando orgs... --</option>
                        </select>
                    </div>
                </div>
                <a href="#" id="refreshOrgsBtn" class="refresh-orgs-link">
                    <i class="fas fa-sync-alt"></i> Actualizar lista de orgs
                </a>
            </div>
            <div class="actions">
                <div class="editor-toggle">
                    <label for="diffEditorSelect">Editor de diff:</label>
                    <select id="diffEditorSelect">
                        <option value="monaco">Monaco</option>
                        <option value="codemirror">CodeMirror</option>
                    </select>
                </div>
                <button id="continueBtn" class="btn-primary">Continuar</button>
            </div>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Pantalla 2: TreeView de Metadata Types -->
    <div id="screen2" class="screen" style="display: none;">
        <div class="container">
            <div class="screen-header">
                <button id="backBtn" class="btn-icon-back" title="Volver">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Metadata Types</h1>
            </div>
            <div class="org-info">
                <button id="toggleTreeviewBtn" class="btn-icon-toggle-treeview" title="Amagar columna de tipus">
                    <i class="fas fa-columns"></i>
                </button>
                <div class="org-info-item">
                    <span class="component-symbol symbol-org-a">A</span>
                    <span id="orgAInfo"></span>
                </div>
                <div class="org-info-separator">
                    <i class="fas fa-arrow-right-arrow-left separator-icon"></i>
                </div>
                <div class="org-info-item">
                    <span class="component-symbol symbol-org-b">B</span>
                    <span id="orgBInfo"></span>
                </div>
                <button id="reviewChangesBtn" class="btn-review-changes" type="button" disabled>
                    <i class="fas fa-list-check"></i>
                    <span>Review changes</span>
                </button>
            </div>
            <div id="metadataTypesWarning" class="warning-message" style="display: none;"></div>
            <div class="main-content">
                <div class="treeview-container" id="treeviewContainer">
                    <div id="treeview" class="treeview">
                        <div class="filter-wrapper">
                            <div class="filter-input-group">
                                <label for="metadataTypeFilter" class="filter-label">
                                    <i class="fas fa-filter"></i> Filtrar tipos de metadata:
                                </label>
                                <div class="filter-input-wrapper">
                                    <input type="text" id="metadataTypeFilter" class="metadata-filter" placeholder="Ej: class *trigger">
                                    <button type="button" id="clearTypeFilterBtn" class="clear-filter-btn" title="Limpiar filtro">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div id="metadataTypeSuggestions" class="metadata-suggestions"></div>
                            </div>
                            <div class="filter-input-group">
                                <label for="componentFilter" class="filter-label">
                                    <i class="fas fa-search"></i> Filtrar componentes:
                                </label>
                                <div class="filter-input-wrapper">
                                    <input type="text" id="componentFilter" class="metadata-filter" placeholder="">
                                    <button type="button" id="clearComponentFilterBtn" class="clear-filter-btn" title="Limpiar filtro">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="resizer" id="resizer"></div>
                <!-- Panel de diff viewer -->
                <div id="diffPanel" class="diff-panel">
                    <div class="diff-panel-header">
                        <h2 id="diffPanelTitle">Comparación de Componente</h2>
                        <div class="diff-panel-actions">
                            <button id="closeDiffBtn" class="btn-icon-close" title="Cerrar">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="diff-labels">
                        <span class="diff-label-left" id="diffLabelA">
                            <span class="component-symbol symbol-org-a">A</span>
                            <span class="diff-label-text">Org A</span>
                        </span>
                        <span class="diff-label-right" id="diffLabelB">
                            <span class="component-symbol symbol-org-b">B</span>
                            <span class="diff-label-text">Org B</span>
                        </span>
                    </div>
                    <div id="diffViewer" class="diff-viewer">
                        <div class="empty-message">
                            Selecciona un component a la columna esquerra per veure aquí les diferències.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal per revisar canvis -->
    <div id="reviewChangesModal" class="modal-overlay" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Review changes</h2>
                <button id="closeReviewChangesBtn" class="btn-icon-close" type="button" title="Tancar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="reviewChangesContent" class="modal-content-body">
                    <!-- Llista d'elements modificats es genera dinàmicament -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="closeReviewChangesBtn" class="btn-modal-secondary">
                    Close
                </button>
                <button type="button" id="deployChangesBtn" class="btn-modal-primary">
                    Deploy
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="/js/app.js"></script>
</body>
</html>
